import React, { Component, PropTypes } from 'react';
import * as d3 from "d3";
import _ from 'lodash';

export default class Controls extends Component {

	static propTypes = {
		onClickInner: PropTypes.func,
		onClickOuter: PropTypes.func
	};

	renderInnerControls () {
		const arcInner = d3.arc().innerRadius(20).outerRadius(95);

		const pieInner = d3.pie()
			.startAngle(-Math.PI / 6)
			.endAngle(Math.PI * 2 + Math.PI / 6)
			.value(d => 1);

		const innerClick = (control, key, event) => {
			event.stopPropagation();

			if (control.data.name === 'comment') {
				this.props.onAddComment(control.data.value);
			} else {
				this.props.onClickInner(key);
			}
		};

		const renderIcon = (name) => {
			switch (name) {
				case 'speed':
					return <path className="icon" transform="translate(-70, -48)" fill-rule="evenodd" clip-rule="evenodd" d="M15,0C6.729,0,0,6.729,0,15s6.729,15,15,15s15-6.729,15-15S23.271,0,15,0z
	 M18.797,6.099l0.958-2.309c0.132-0.318,0.497-0.472,0.816-0.339c0.319,0.131,0.47,0.499,0.339,0.816l-0.957,2.309
	c-0.133,0.322-0.504,0.47-0.816,0.338C18.816,6.784,18.665,6.418,18.797,6.099z M15,3.356c0-0.345,0.154-0.625,0.5-0.625
	S16,3.012,16,3.356v2.5c0,0.345-0.154,0.625-0.5,0.625S15,6.202,15,5.857V3.356z M10.217,3.451c0.318-0.134,0.686,0.021,0.816,0.338
	l0.957,2.31c0.133,0.319-0.02,0.686-0.339,0.816c-0.31,0.131-0.683-0.014-0.816-0.338l-0.956-2.31
	C9.748,3.949,9.898,3.582,10.217,3.451z M2.43,14.5c0-0.345,0.28-0.5,0.625-0.5h2.5C5.9,14,6.18,14.155,6.18,14.5S5.9,15,5.555,15
	h-2.5C2.71,15,2.43,14.845,2.43,14.5z M6.578,19.165l-2.312,0.956c-0.312,0.132-0.682-0.016-0.815-0.339
	c-0.132-0.319,0.021-0.685,0.339-0.816L6.1,18.01c0.318-0.134,0.684,0.021,0.816,0.339C7.047,18.669,6.896,19.034,6.578,19.165z
	 M6.916,11.651c-0.133,0.322-0.505,0.47-0.817,0.339L3.79,11.032c-0.319-0.131-0.47-0.497-0.337-0.816
	c0.131-0.318,0.498-0.472,0.815-0.338l2.31,0.957C6.897,10.966,7.049,11.332,6.916,11.651z M7.929,8.812L6.162,7.045
	c-0.243-0.244-0.243-0.64,0-0.884c0.244-0.243,0.641-0.243,0.885,0l1.766,1.768c0.244,0.244,0.244,0.64,0,0.884
	S8.172,9.057,7.929,8.812z M22,24.375C22,24.72,21.72,25,21.375,25H9.625C9.28,25,9,24.72,9,24.375v-3.75C9,20.28,9.28,20,9.625,20
	h11.75C21.72,20,22,20.28,22,20.625V24.375z M17.146,13.737C17.365,14.11,17.5,14.539,17.5,15c0,1.378-1.121,2.5-2.5,2.5
	s-2.5-1.122-2.5-2.5s1.121-2.5,2.5-2.5c0.463,0,0.891,0.134,1.263,0.354l5.808-5.809c0.244-0.244,0.64-0.244,0.883,0
	c0.244,0.244,0.244,0.64,0,0.884L17.146,13.737z M23.422,10.835l2.31-0.956c0.318-0.133,0.685,0.02,0.815,0.339
	c0.132,0.318-0.02,0.685-0.338,0.816L23.9,11.99c-0.309,0.13-0.684-0.014-0.816-0.339C22.951,11.332,23.103,10.966,23.422,10.835z
	 M26.547,19.784c-0.133,0.322-0.504,0.47-0.815,0.338l-2.31-0.957c-0.318-0.131-0.471-0.497-0.338-0.816
	c0.131-0.32,0.497-0.471,0.816-0.339l2.309,0.958C26.529,19.099,26.68,19.465,26.547,19.784z M26.873,15l-2.5-0.001
	c-0.344,0-0.625-0.155-0.625-0.5c0-0.346,0.281-0.5,0.625-0.5h2.5c0.346,0,0.625,0.155,0.625,0.5S27.219,15,26.873,15z"/>;
				case 'goal': {
					return <path className="icon" transform="translate(-15, -70)" fill-rule="evenodd" clip-rule="evenodd" d="M13.75,10h2.5v2.5h-2.5V10z M21.25,16.25h2.5v-2.5h-2.5V16.25z M10,12.5h2.5V10H10
	V12.5z M21.25,12.5h2.5V10h-2.5V12.5z M17.5,12.5H20V10h-2.5V12.5z M10,16.25h2.5v-2.5H10V16.25z M13.75,16.25h2.5v-2.5h-2.5V16.25z
	 M17.5,16.25H20v-2.5h-2.5V16.25z M21.25,8.75h2.5v-2.5h-2.5V8.75z M10,8.75h2.5v-2.5H10V8.75z M6.25,12.5h2.5V10h-2.5V12.5z
	 M6.25,16.25h2.5v-2.5h-2.5V16.25z M13.75,8.75h2.5v-2.5h-2.5V8.75z M17.5,8.75H20v-2.5h-2.5V8.75z M0.884,0l5,5H8.75H10h2.5h1.25
	h2.5h1.25H20h1.25h2.866l5-5H0.884z M30,0.884l-5,5v10.994l4.096,3.056c0.193,0.097,0.423,0.088,0.607-0.026S30,19.593,30,19.375
	 M5,14.375v-1.25v-2.5v-1.25V5.884l-5-5v18.491c0,0.218,0.112,0.419,0.297,0.532C0.396,19.97,0.51,20,0.625,20
	c0.096,0,0.191-0.022,0.279-0.066L5,16.875V14.375z M6.25,8.75h2.5v-2.5h-2.5V8.75z"/>;
				}
				case 'pass': {
					return <path className="icon" transform="translate(38, -38)" fill-rule="evenodd" clip-rule="evenodd" d="M0,5c0-2.762,2.238-5,5-5s5,2.238,5,5s-2.238,5-5,5S0,7.762,0,5z M31,10
	c2.762,0,5-2.238,5-5s-2.238-5-5-5s-5,2.238-5,5S28.238,10,31,10z M23.5,5.5C23.5,4.671,22.828,4,22,4h-1
	c-0.828,0-1.5,0.671-1.5,1.5S20.172,7,21,7h1C22.828,7,23.5,6.329,23.5,5.5z M17.5,5.5C17.5,4.671,16.828,4,16,4h-1
	c-0.828,0-1.5,0.671-1.5,1.5S14.172,7,15,7h1C16.828,7,17.5,6.329,17.5,5.5z"/>;
				}
				case 'tackle': {
					return <path className="icon" transform="translate(40, 15)" fill-rule="evenodd" clip-rule="evenodd" d="M24,6c0,3.31-2.691,6-6,6H8.332c-1.652,0-3-1.346-3-3V6
	c0-0.369-0.3-0.666-0.664-0.666C4.301,5.334,3.999,5.631,3.999,6v3c0,2.389,1.942,4.333,4.333,4.333h5.883
	c0.293,0.742,0.45,1.521,0.45,2.333c0,0.955-0.2,1.867-0.607,2.715c-0.159,0.332-0.015,0.73,0.316,0.89
	c0.33,0.155,0.731,0.018,0.891-0.316c0.488-1.031,0.734-2.135,0.734-3.289c0-0.801-0.128-1.582-0.37-2.333H18
	c1.77,0,3.398-0.631,4.668-1.679v3.012c0,3.725-1.82,7.191-4.872,9.314L4.864,23.977C1.816,21.852,0,18.389,0,14.666V6
	c0-3.31,2.691-6,6-6h12C21.309,0,24,2.69,24,6z M3.999,25.333v5.333h14.669v-5.333H3.999z"/>;
				}
				case 'comment': {
					return <path className="icon" transform="translate(-15, 50)" fill-rule="evenodd" clip-rule="evenodd" d="M22.104,17.519l3.875,3.876c-1.621,1.622-0.462,0.463-5.793,5.793l-3.875-3.876
	L22.104,17.519z M14.807,23.105l9.359-9.358V0.604c0-0.334-0.27-0.604-0.604-0.604h-3.021v4.833h-2.416V0h-2.416v4.833h-2.418V0
	h-2.416v4.833H8.459V0H6.041v4.833H3.625V0H0.604C0.271,0,0,0.271,0,0.604v24.166c0,0.334,0.271,0.604,0.604,0.604H14.08
	l0.573-2.007C14.682,23.269,14.734,23.18,14.807,23.105z M14.521,28.229c-0.061,0.211-0.003,0.438,0.153,0.593
	c0.15,0.148,0.37,0.217,0.591,0.153l3.89-1.111l-3.523-3.523L14.521,28.229z M28.824,17.695l-3.021-3.021
	c-0.236-0.235-0.619-0.235-0.854,0l-1.989,1.99l3.875,3.875l1.988-1.988C29.059,18.313,29.059,17.932,28.824,17.695z"/>;
				}
				case 'technique': {
					return <path className="icon" transform="translate(-70, 20)" fill-rule="evenodd" clip-rule="evenodd" d="M33.943,4.334c-2.541,0-4.627,1.891-4.981,4.333H0.045
	C0.156,7.88,0.674,7.195,1.438,6.922L13.24,2.707l2.137,2.138c0.142,0.141,0.326,0.211,0.512,0.211c0.185,0,0.369-0.07,0.511-0.211
	c0.282-0.281,0.282-0.739,0-1.021l-1.653-1.652l1.16-0.415l2.361,2.366c0.14,0.14,0.324,0.211,0.51,0.211
	c0.185,0,0.369-0.071,0.512-0.211c0.281-0.28,0.281-0.738,0-1.02l-1.88-1.884l3.292-1.176C20.92-0.036,21.166,0,21.359,0.135
	c0.192,0.135,0.307,0.354,0.307,0.588c0,0.582,1.377,1.444,4.334,1.444c2.459,0,4.332-0.962,4.332-1.444
	C30.332,0.324,30.656,0,31.055,0H32.5c1.193,0,2.166,0.973,2.166,2.167v2.167H33.943z M30.406,8.667h4.26V5.778h-0.723
	C32.199,5.778,30.741,7.021,30.406,8.667z M0,10.111v2.167C0,12.677,0.322,13,0.722,13h0.722v0.723c0,0.398,0.324,0.723,0.723,0.723
	s0.723-0.324,0.723-0.723V13h2.889v0.723c0,0.398,0.323,0.723,0.723,0.723c0.398,0,0.722-0.324,0.722-0.723V13h2.889v0.723
	c0,0.398,0.323,0.723,0.722,0.723c0.399,0,0.723-0.324,0.723-0.723V13h2.889v0.723c0,0.398,0.324,0.723,0.723,0.723
	s0.723-0.324,0.723-0.723V13h11.555v0.723c0,0.398,0.324,0.723,0.723,0.723s0.723-0.324,0.723-0.723V13h5.055
	c0.398,0,0.723-0.323,0.723-0.722v-2.167H0z"/>;
				}
			}
		};

		return pieInner(this.props.controls).map((control, key) => {
			return (
				<g
					key={ key }
					className={ `control-inner ${ this.props.activeOuter === key || (this.props.commentActive && control.data.name === 'comment') ? 'active' : ''}` }
				>
					<path
						onClick={ innerClick.bind(this, control, key) }
						onTouchStart={ innerClick.bind(this, key) }
						className="section"
						d={ arcInner(control) }
						/>
					{ renderIcon(control.data.name) }
				</g>
			);
		});
	};

	renderOuterControls () {
		const arcOuter = d3.arc().innerRadius(95).outerRadius(175);
		const labelArc = d3.arc().outerRadius(175-40).innerRadius(175-40);

		const pieOuter = (innerControl) => {
			const startAngle = -Math.PI / 3 + Math.PI / 3 * innerControl;
			const endAngle = Math.PI / 3 + Math.PI / 3 * innerControl;

			return d3.pie()
				.startAngle(startAngle)
				.endAngle(endAngle)
				.sort(null)
				.value(1);
		};

		const renderLabel = (key) => {
			switch (key) {
				case 0: return '––';
				case 1: return '–';
				case 2: return '+';
				case 3: return '++';
			}
		};

		const outerClick = (key, event) => {
			event.stopPropagation();
			this.props.onClickOuter(key);
		};

		if (this.props.activeOuter || this.props.activeOuter === 0) {
			return pieOuter(this.props.activeOuter)([0,1,2,3]).map((control, key) => {
				return (
					<g className={ `control-outer ${ this.props.controls[this.props.activeOuter].value === key ? 'active' : ''}` } key={ key } >
						<path onClick={ outerClick.bind(this, key) } className="section" d={ arcOuter(control) }></path>
						<text dy=".2em" transform={ "translate(" + labelArc.centroid(control) + ")" }>
							{ renderLabel(key) }
						</text>
					</g>
				);
			});
		}
	};

	render () {
		return (
			<g>
				{ this.renderInnerControls() }
				{ this.renderOuterControls() }
			</g>
		)
	}
}